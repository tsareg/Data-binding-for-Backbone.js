/**
 * Backbone.DataBinding v0.4.5
 * https://github.com/DreamTheater/Backbone.DataBinding
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
!function(a){"use strict";var b="object"==typeof module&&"object"==typeof exports,c=b?{_:require("underscore"),Backbone:require("backbone")}:window;(b?exports:Backbone).ModelBinder=a(c,b)}(function(a){"use strict";var b,c=a._,d=a.Backbone,e=d.ModelBinder=function(a,d){return this instanceof e?(b=c.extend(this,{view:a,model:d},{bindings:{}}),c.extend(a,{render:c.wrap(a.render,function(a){return a.call(this),b.refresh(),this}),setElement:c.wrap(a.setElement,function(a,c,d){return this.$el&&b.undelegateEvents(),a.call(this,c,d),d!==!1&&b.delegateEvents(),this})}),void 0):new e(a,d)};return c.extend(e,{extend:d.View.extend},{handlers:{html:{getter:function(){return this.html()},setter:function(a){a=c.isNull(a)||c.isUndefined(a)?"":String(a),this.html(a)}},text:{getter:function(){return this.text()},setter:function(a){a=c.isNull(a)||c.isUndefined(a)?"":String(a),this.text(a)}},value:{getter:function(){var a=this.val()||[];return this.is("[multiple]")?a:String(a)},setter:function(a){a=c.isArray(a)?c.reject(a,function(a){return c.isNull(a)||c.isUndefined(a)}):c.isNull(a)||c.isUndefined(a)?this.is("[multiple]")?[]:"":String(a),this.val(a)}},checked:{getter:function(){var a,b=c.chain(this).where({checked:!0}).pluck("value").value();return a="radio"===this.prop("type")?b[0]:1===this.length?this.prop("checked"):b},setter:function(a){var b=c.chain([a]).flatten().reject(function(a){return c.isNull(a)||c.isUndefined(a)}).value();"radio"===this.prop("type")?this.val(b):1===this.length?this.prop("checked",a):this.val(b)}},visible:{getter:function(){return!this.prop("hidden")},setter:function(a){this.prop("hidden",!a)}},hidden:{getter:function(){return this.prop("hidden")},setter:function(a){this.prop("hidden",!!a)}},enabled:{getter:function(){return!this.prop("disabled")},setter:function(a){this.prop("disabled",!a)}},disabled:{getter:function(){return this.prop("disabled")},setter:function(a){this.prop("disabled",!!a)}}}}),c.extend(e.prototype,{constructor:e},{watch:function(a,b){var d;return!a||c.isObject(a)?d=a:(d={})[a]=b,c.each(d,function(a,b){a=a||{},this.stopListening(b).undelegateEvents(b)._addBinding(b,a).delegateEvents(b).startListening(b)},this),this.refresh(),this},refresh:function(){var a=c.pluck(this.bindings,"setter");return c.each(a,function(a){a&&a()}),this},delegateEvents:function(a){var b=this.bindings;return a&&(b=c.pick(b,a)),c.each(b,function(a,b){var c=this._resolveEvents.call({view:this.view,options:a},b),d=a.selector,e=a.getter;this.undelegateEvents(b),e&&this.view.$el.on(c,d,e)},this),this},undelegateEvents:function(a){var b=this.bindings;return a&&(b=c.pick(b,a)),c.each(b,function(a,b){var c=this._resolveEvents.call({view:this.view,options:a},b),d=a.selector,e=a.getter;e&&this.view.$el.off(c,d,e)},this),this},startListening:function(a){var b=this.bindings;return a&&(b=c.pick(b,a)),c.each(b,function(a,b){var c=a.setter;this.stopListening(b),c&&this.view.listenTo(this.model,"change",c)},this),this},stopListening:function(a){var b=this.bindings;return a&&(b=c.pick(b,a)),c.each(b,function(a){var b=a.setter;b&&this.view.stopListening(this.model,"change",b)},this),this},_addBinding:function(a,b){var d=a.match(/^\s*([-\w]+)\s*:\s*([-\w]+)\s*$/),e=d[1],f=d[2],g=this.constructor,h=g.handlers[e],i=h&&h.getter,j=h&&h.setter;return this.bindings[a]=c.defaults(b,{getter:c.wrap(i,function(a){var c=this._resolveElement.call({view:this.view,selector:b.selector}),d=a?a.call(c):c.attr(e);return this.model.set(f,d,b)}),setter:c.wrap(j,function(a){var c=this._resolveElement.call({view:this.view,selector:b.selector}),d=this.model.get(f);return a?a.call(c,d):c.attr(e,d)})}),this._bindHandlers(b),this},_bindHandlers:function(a){var b=a.getter,d=a.setter;return b&&(a.getter=c.bind(b,this)),d&&(a.setter=c.bind(d,this)),this},_resolveElement:function(){var a=this.view,b=this.selector;return c.isFunction(b)&&(b=b.call(a)),b?a.$(b):a.$el},_resolveEvents:function(a){var b=this.options.event||"change",d=b.match(/\S+/g);return d=c.map(d,function(b){return b+"."+a+".modelBinder."+this.view.cid},this),d.join(" ")}}),e}),function(a){"use strict";var b="object"==typeof module&&"object"==typeof exports,c=b?{_:require("underscore"),Backbone:require("backbone")}:window;(b?exports:Backbone).CollectionBinder=a(c,b)}(function(a){"use strict";var b,c=a._,d=a.Backbone,e=d.CollectionBinder=function(a,d,f){return this instanceof e?(b=c.extend(this,{view:a,collection:d,options:f},{views:[]}),c.extend(a,{render:c.wrap(a.render,function(a){return a.call(this),b.refresh(),this}),remove:c.wrap(a.remove,function(a){return b.removeViews().removeDummy(),a.call(this),this})}),void 0):new e(a,d,f)};return c.extend(e,{extend:d.View.extend},{handlers:{add:function(a){var b=this.views,d=this._resolveView(a)||this._prepareView(a),e=c.indexOf(b,d);if(-1===e&&b.push(d),0===d.$el.parent().length){var f=this._resolveElement.call({view:this.view,selector:this.options.selector},a);d.$el.appendTo(f)}},remove:function(a){var b=this.views,d=this._resolveView(a),e=c.indexOf(b,d);-1!==e&&b.splice(e,1),d&&d.remove()},reset:function(a){this.removeViews().renderViews(a)},sort:function(a){var b=this.views,d=a.comparator;d&&(c.isString(d)?this.views=c.sortBy(b,function(a){return a.model.get(d)}):1===d.length?this.views=c.sortBy(b,function(b){return d.call(a,b.model)}):b.sort(function(b,c){return d.call(a,b.model,c.model)}),this.detachViews().renderViews(a))}}}),c.extend(e.prototype,{constructor:e},{listen:function(a){return a=a||{},this.stopListening()._addHandlers(a).startListening(),this.refresh(),this},refresh:function(){var a=this.handlers.reset;return a&&a(this.collection),this},renderViews:function(a){var b=a.models;return c.each(b,function(a){this.handlers.add(a)},this),this},removeViews:function(){for(var a=this.views;a.length>0;)this.handlers.remove(a[0].model);return this},detachViews:function(){var a=this.views;return c.each(a,function(a){a.$el.detach()}),this},renderDummy:function(){var a=this.dummy||this._prepareDummy();if(a&&(this.dummy=a,0===a.$el.parent().length)){var b=this._resolveElement.call({view:this.view,selector:this.options.selector});a.$el.appendTo(b)}return this},removeDummy:function(){var a=this.dummy;return delete this.dummy,a&&a.remove(),this},detachDummy:function(){var a=this.dummy;return a&&a.$el.detach(),this},startListening:function(a){var b=this.handlers;return a&&(b=c.pick(b,a)),c.each(b,function(a,b){this.stopListening(b),a&&this.view.listenTo(this.collection,b,a)},this),this},stopListening:function(a){var b=this.handlers;return a&&(b=c.pick(b,a)),c.each(b,function(a,b){a&&this.view.stopListening(this.collection,b,a)},this),this},_addHandlers:function(a){var b=this.constructor,d=b.handlers,e=d&&d.add,f=d&&d.remove,g=d&&d.reset,h=d&&d.sort;return this.handlers=c.defaults(a,{add:c.wrap(e,function(a,b){this.detachDummy(),a.call(this,b)}),remove:c.wrap(f,function(a,b){a.call(this,b),this.collection.isEmpty()&&this.renderDummy()}),reset:c.wrap(g,function(a,b){this.removeDummy(),a.call(this,b),this.collection.isEmpty()&&this.renderDummy()}),sort:c.wrap(h,function(a,b){a.call(this,b)})}),this._bindHandlers(a),this},_bindHandlers:function(a){var b=a.add,d=a.remove,e=a.reset,f=a.sort;return b&&(a.add=c.bind(b,this)),d&&(a.remove=c.bind(d,this)),e&&(a.reset=c.bind(e,this)),f&&(a.sort=c.bind(f,this)),this},_resolveElement:function(a){var b=this.view,d=this.selector;return c.isFunction(d)&&(d=d.call(b,a)),d?b.$(d):b.$el},_resolveView:function(a){var b=this.views;return c.find(b,function(b){return b.model===a})},_prepareView:function(a){var b,c=this.options.view;try{b=new c({model:a})}catch(d){throw d}return b.render()},_prepareDummy:function(){var a,b=this.options.dummy;try{a=new b}catch(c){return}return a.render()}}),e});